<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Control ESP32 - API Gateway</title>
</head>
<body>
<h2>üéõÔ∏è Control ESP32 via API Gateway</h2>
<div class="controls">
  <button onclick="enviarComando('LED_ON')">LED ON</button>
  <button onclick="enviarComando('LED_OFF')">LED OFF</button>
  <button onclick="obtenerEstado()">Obtener Estado</button>
  <button onclick="limpiar()">Limpiar</button>
</div>
<pre id="log"></pre>

<script>
// REEMPLAZA ESTO con tu URL de API Gateway
const API_URL = 'https://027nr82y14.execute-api.us-east-1.amazonaws.com/iot';

const log = (m) => {
  const time = new Date().toLocaleTimeString();
  document.getElementById("log").textContent += `[${time}] ${m}\n`;
  document.getElementById("log").scrollTop = document.getElementById("log").scrollHeight;
};

function limpiar() {
  document.getElementById("log").textContent = "";
}

async function enviarComando(comando) {
  log(`üì§ Enviando comando: ${comando}`);
  
  try {
    const response = await fetch(API_URL, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        action: 'publish',
        topic: 'esp32/sub',
        message: {
          comando: comando,
          timestamp: new Date().toISOString()
        }
      })
    });
    
    const data = await response.json();
    
    if (data.success) {
      log(`‚úÖ Comando enviado exitosamente`);
      log(`   Topic: ${data.topic}`);
    } else {
      log(`‚ùå Error: ${data.error}`);
    }
    
  } catch (error) {
    log(`‚ùå Error de conexi√≥n: ${error.message}`);
  }
}

async function obtenerEstado() {
  log(`üîç Obteniendo estado del ESP32...`);
  
  try {
    const response = await fetch(API_URL, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        action: 'get_shadow',
        thing_name: 'esp32'
      })
    });
    
    const data = await response.json();
    
    if (data.success) {
      log(`‚úÖ Estado obtenido:`);
      log(JSON.stringify(data.shadow, null, 2));
    } else {
      log(`‚ùå Error: ${data.error}`);
    }
    
  } catch (error) {
    log(`‚ùå Error: ${error.message}`);
  }
}

// Test de conexi√≥n al cargar
window.addEventListener('load', () => {
  log('üìÑ P√°gina cargada');
  log('üîó API URL: ' + API_URL);
  log('‚úÖ Sistema listo');
});
</script>

<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  
  body {
    font-family: 'Segoe UI', sans-serif;
    padding: 30px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
  }
  
  h2 {
    color: white;
    text-align: center;
    margin-bottom: 20px;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
  }
  
  .controls {
    background: white;
    padding: 20px;
    border-radius: 12px;
    text-align: center;
    margin: 0 auto 20px;
    max-width: 600px;
    box-shadow: 0 8px 16px rgba(0,0,0,0.2);
  }
  
  button {
    padding: 12px 28px;
    margin: 5px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    color: white;
    border: none;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.2);
    transition: all 0.3s;
  }
  
  button:nth-child(1) { background: linear-gradient(135deg, #11998e, #38ef7d); }
  button:nth-child(2) { background: linear-gradient(135deg, #ee0979, #ff6a00); }
  button:nth-child(3) { background: linear-gradient(135deg, #667eea, #764ba2); }
  button:nth-child(4) { background: linear-gradient(135deg, #434343, #000); }
  
  button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(0,0,0,0.3);
  }
  
  #log {
    background: #1a1a2e;
    color: #00ff41;
    padding: 20px;
    border-radius: 12px;
    max-width: 900px;
    margin: 0 auto;
    height: 500px;
    overflow-y: auto;
    font-family: 'Courier New', monospace;
    font-size: 14px;
    white-space: pre-wrap;
    box-shadow: 0 8px 16px rgba(0,0,0,0.4);
  }
</style>
</body>
</html>
