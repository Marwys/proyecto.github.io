<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>AWS IoT - Diagn√≥stico</title>
  <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1370.0.min.js"></script>
</head>
<body>
<h2>Diagn√≥stico de pol√≠ticas IoT</h2>
<button onclick="verificar()">Verificar Configuraci√≥n</button>
<pre id="log"></pre>

<script>
const log = (m) => {
  document.getElementById("log").textContent += m + "\n";
  console.log(m);
};

AWS.config.region = "us-east-1";
AWS.config.credentials = new AWS.CognitoIdentityCredentials({
  IdentityPoolId: "us-east-1:7860e2f2-eb64-4494-9c2a-fe735c8912ec"
});

function verificar() {
  log("üîç Verificando configuraci√≥n...\n");
  
  AWS.config.credentials.get((err) => {
    if (err) {
      log("‚ùå Error: " + err.message);
      return;
    }
    
    log("‚úÖ Identity ID: " + AWS.config.credentials.identityId);
    log("‚úÖ AccessKeyId: " + AWS.config.credentials.accessKeyId);
    log("");
    
    // Verificar pol√≠ticas adjuntas
    const iot = new AWS.Iot();
    
    // Listar todas las pol√≠ticas
    iot.listPolicies({}, (err, data) => {
      if (err) {
        log("‚ö†Ô∏è No se pueden listar pol√≠ticas: " + err.code);
        log("   (Esto es normal si el rol no tiene permiso iot:ListPolicies)");
      } else {
        log("üìã Pol√≠ticas IoT disponibles:");
        data.policies.forEach(p => {
          log("   - " + p.policyName);
        });
      }
      log("");
      
      // Intentar listar targets de la pol√≠tica
      iot.listTargetsForPolicy({ policyName: 'WebClientPolicy' }, (err, data) => {
        if (err) {
          log("‚ùå Error listando targets: " + err.code);
          log("   Aseg√∫rate que la pol√≠tica 'WebClientPolicy' existe");
        } else {
          log("üéØ Targets de WebClientPolicy:");
          if (data.targets && data.targets.length > 0) {
            data.targets.forEach(t => {
              log("   - " + t);
              if (t === AWS.config.credentials.identityId) {
                log("     ‚úÖ Tu Identity ID est√° adjuntado!");
              }
            });
          } else {
            log("   ‚ö†Ô∏è No hay targets adjuntados a esta pol√≠tica");
            log("   ‚ùó DEBES adjuntar tu Identity ID:");
            log("   " + AWS.config.credentials.identityId);
          }
        }
      });
    });
  });
}
</script>

<style>
  body { font-family: Arial; padding: 20px; max-width: 900px; margin: 0 auto; }
  button { padding: 12px 24px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
  #log { background: #1e1e1e; color: #0f0; padding: 20px; border-radius: 5px; height: 500px; overflow-y: auto; font-family: monospace; margin-top: 20px; white-space: pre-wrap; }
</style>
</body>
</html>
