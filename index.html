<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>AWS IoT Web</title>

  <!-- AWS SDK -->
  <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1370.0.min.js"></script>

  <!-- AWS IoT DEVICE SDK (BROWSER ‚Äì CDN CORRECTO) -->
  <script src="https://cdn.jsdelivr.net/npm/aws-iot-device-sdk/browser/aws-iot-sdk-browser-bundle.min.js"></script>
</head>
<body>

<h2>AWS IoT Web</h2>
<button onclick="conectar()">Conectar</button>

<pre id="log"></pre>

<script>
const log = (m) => {
  console.log(m);
  document.getElementById("log").textContent += m + "\n";
};

log("üìÑ HTML cargado");
log("awsIot existe: " + (typeof awsIot));

const cfg = {
  region: "us-east-1",
  identityPoolId: "us-east-1:7860e2f2-eb64-4494-9c2a-fe735c8912ec",
  iotEndpoint: "a1eyoxsww0xvbl-ats.iot.us-east-1.amazonaws.com"
};

AWS.config.region = cfg.region;
AWS.config.credentials = new AWS.CognitoIdentityCredentials({
  IdentityPoolId: cfg.identityPoolId
});

function conectar() {
  log("üîÑ Obteniendo credenciales...");

  AWS.config.credentials.get(err => {
    if (err) {
      log("‚ùå Cognito error: " + err);
      return;
    }

    log("‚úÖ Credenciales OK");

    const client = awsIot.device({
      region: cfg.region,
      host: cfg.iotEndpoint,
      protocol: "wss",
      clientId: "web-" + Math.random().toString(16).slice(2),
      accessKeyId: AWS.config.credentials.accessKeyId,
      secretKey: AWS.config.credentials.secretAccessKey,
      sessionToken: AWS.config.credentials.sessionToken,
      debug: true
    });

    client.on("connect", () => {
      log("üöÄ CONECTADO A AWS IOT");
    });

    client.on("error", e => {
      log("‚ùå IoT error: " + e.message);
    });
  });
}
</script>

</body>
</html>
